{{- /*
  Render cluster-level cassandra spec according to K8ssandraCluster.spec.cassandra
  - Uses $.Values.cassandra for cluster defaults
  - Datacenters are rendered by k8ssandra.datacenters (below)
*/ -}}
{{- define "k8ssandra.cassandra" -}}
clusterName: {{ .Values.cassandra.clusterName | default $.Values.clusterName | quote }}
serverVersion: {{ .Values.cassandra.serverVersion | default .Values.cassandra.version | quote }}
{{- with .Values.cassandra.softPodAntiAffinity }}
softPodAntiAffinity: {{ . }}
{{- end }}
{{- with .Values.cassandra.metadata }}
metadata:
  {{- if .commonLabels }}
  commonLabels:
{{ toYaml . | nindent 4 }}
  {{- end }}
  {{- if .commonAnnotations }}
  commonAnnotations:
{{ toYaml . | nindent 4 }}
  {{- end }}
  {{- end }}
{{- with .Values.cassandra.config }}
config:
  {{- if .cassandraYaml }}
  cassandraYaml:
{{ toYaml . | nindent 4 }}
  {{- end }}
  {{- if .jvmOptions }}
  jvmOptions:
{{ toYaml . | nindent 4 }}
  {{- end }}
{{- end }}
{{- with .Values.cassandra.managementApiAuth }}
managementApiAuth:
{{ toYaml . | nindent 2 }}
{{- end -}}
{{- with .Values.cassandra.mgmtAPIHeap }}
mgmtAPIHeap: {{ . }}
{{- end }}
{{- with .Values.cassandra.podSecurityContext }}
podSecurityContext:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.resources }}
# top-level default resources (still per-DC overrides possible)
resources:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.telemetry }}
telemetry:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.storageConfig }}
storageConfig:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.tolerations }}
tolerations:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.clientEncryptionStores }}
clientEncryptionStores:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.serverEncryptionStores }}
serverEncryptionStores:
{{ toYaml . | nindent 2 }}
{{- end }}
{{- with .Values.cassandra.superuserSecretRef }}
superuserSecretRef:
{{ toYaml . | nindent 2 }}
{{- end }}
datacenters: {{ include "k8ssandra.datacenters" . | indent 2 }}
{{- end -}}