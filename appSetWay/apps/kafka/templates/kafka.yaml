## Kafka Cluster Resources

apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: {{ .Values.kafkaCluster.name }}
  annotations:
    {{- range $key, $value := .Values.kafkaCluster.annotations }}
    strimzi.io/{{ $key }}: {{ $value | quote }}
    {{- end }}
spec:
  kafka:
    version: {{ .Values.kafkaCluster.kafka.version }}
    metadataVersion: {{ .Values.kafkaCluster.kafka.metadataVersion }}
    {{- if .Values.kafkaCluster.kafka.listeners }}
    listeners:
      {{- range .Values.kafkaCluster.kafka.listeners }}
      - name: {{ .name }}
        port: {{ .port }}
        type: {{ .type }}
        tls: {{ .tls }}
      {{- end }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.config }}
    config:
      {{- range $key, $value := .Values.kafkaCluster.kafka.config }}
      {{ $key }}: {{ $value | quote }}
      {{- end }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.resources }}
    resources:
      {{- toYaml .Values.kafkaCluster.kafka.resources | nindent 6 }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.logging }}
    logging:
      type: inline
      loggers:
        {{- range $key, $value := .Values.kafkaCluster.kafka.logging }}
        {{ $key }}: {{ $value }}
        {{- end }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.readinessProbe }}
    readinessProbe:
      {{- toYaml .Values.kafkaCluster.kafka.readinessProbe | nindent 6 }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.livenessProbe }}
    livenessProbe:
      {{- toYaml .Values.kafkaCluster.kafka.livenessProbe | nindent 6 }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.jvmOptions }}
    jvmOptions:
      {{- range $key, $value := .Values.kafkaCluster.kafka.jvmOptions }}
      "{{ $key }}": "{{ $value }}"
      {{- end }}
    {{- end }}
    {{- if .Values.kafkaCluster.kafka.authorization }}
    authorization:
      {{- toYaml .Values.kafkaCluster.kafka.authorization | nindent 6 }}
    {{- end }}

  {{- if .Values.kafkaCluster.entityOperator.enabled }}
  entityOperator:
    {{- if .Values.kafkaCluster.entityOperator.topicOperator }}
    topicOperator:
      {{- toYaml .Values.kafkaCluster.entityOperator.topicOperator | nindent 6 }}
    {{- end }}
    {{- if .Values.kafkaCluster.entityOperator.userOperator }}
    userOperator:
      {{- toYaml .Values.kafkaCluster.entityOperator.userOperator | nindent 6 }}
    {{- end }}
  {{- end }}

  {{- if .Values.kafkaCluster.kafkaExporter.enabled }}
  kafkaExporter:
    topicRegex: {{ .Values.kafkaCluster.kafkaExporter.topicRegex | quote }}
    groupRegex: {{ .Values.kafkaCluster.kafkaExporter.groupRegex | quote }}
  {{- end }}

  {{- if .Values.kafkaCluster.cruiseControl.enabled }}
  cruiseControl:
    autoRebalance:
      {{- range .Values.kafkaCluster.cruiseControl.templates }}
      - mode: {{ if hasPrefix .name "add" }}add-brokers{{ else }}remove-brokers{{ end }}
        template:
          name: {{ .name }}
      {{- end }}
  {{- end }}
---
{{- if .Values.kafkaCluster.cruiseControl.enabled }}
{{- range .Values.kafkaCluster.cruiseControl.templates }}
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: {{ .name }}
  annotations:
    strimzi.io/rebalance-template: "true"
spec: {}
---
{{- end }}
{{- end }}
